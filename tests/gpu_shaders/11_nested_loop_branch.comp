#version 450
layout(local_size_x = 256) in;
layout(set=0, binding=0) buffer Input  { float data[]; } inp;
layout(set=0, binding=1) buffer Output { float data[]; } out_;
void main() {
    uint gid = gl_GlobalInvocationID.x;
    float val = inp.data[gid];
    // Nested stress test: outer loop > branch > inner loop
    // n = min(uint(val), 6)
    // acc = 0
    // for i = 1 to n:
    //   if float(i) > 3.0:
    //     s = 0; for j = 1 to i: s += float(j)
    //     acc += s
    //   else:
    //     acc += float(i)
    uint n = min(uint(val), 6u);
    float acc = 0.0;
    for (uint i = 1u; i <= n; i++) {
        float fi = float(i);
        if (fi > 3.0) {
            float s = 0.0;
            for (uint j = 1u; j <= i; j++) {
                s += float(j);
            }
            acc += s;
        } else {
            acc += fi;
        }
    }
    out_.data[gid] = acc;
}
