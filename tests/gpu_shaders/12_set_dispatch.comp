#version 450
// 12_set_dispatch.comp â€” GPU self-scheduling: writes VkDispatchIndirectCommand
// Binding 0: input float array. input[0] = element count.
// Binding 1: output uint array = VkDispatchIndirectCommand {x, y, z}.
// Single invocation reads element count, computes ceil(count/256) workgroups.
layout(local_size_x = 1) in;
layout(set=0, binding=0) buffer Input  { float data[]; } inp;
layout(set=0, binding=1) buffer Output { uint  params[]; } out_;
void main() {
    uint count = uint(inp.data[0]);
    uint wg_size = 256u;
    uint groups = (count + wg_size - 1u) / wg_size;
    out_.params[0] = groups;  // x workgroups
    out_.params[1] = 1u;     // y = 1
    out_.params[2] = 1u;     // z = 1
}
