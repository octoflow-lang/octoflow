#version 450
// bfs_check â€” Check if frontier is empty (reduce OR)
//
// Scans frontier array and writes 1.0 to output[wg_id] if any
// element in this workgroup's slice is 1.0, else 0.0.
// After reduction, if all outputs are 0.0, BFS is complete.
//
// 2 bindings, 0 push constants.
layout(local_size_x = 256) in;

layout(set=0, binding=0) buffer Frontier { float data[]; } frontier;
layout(set=0, binding=1) buffer Output   { float data[]; } out_;

shared float partial[256];

void main() {
    uint tid = gl_LocalInvocationID.x;
    uint gid = gl_GlobalInvocationID.x;

    partial[tid] = frontier.data[gid];
    barrier();

    // Tree reduction (OR = max for 0/1 values)
    for (uint s = 128u; s > 0u; s >>= 1u) {
        if (tid < s) {
            partial[tid] = max(partial[tid], partial[tid + s]);
        }
        barrier();
    }

    if (tid == 0u) {
        out_.data[gl_WorkGroupID.x] = partial[0];
    }
}
