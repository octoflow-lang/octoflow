#version 450
// ecs_gravity â€” ECS gravity system (GPU)
//
// Applies constant gravitational acceleration to all active entities.
// SoA: vel_y[i] += gravity * dt for each active entity.
//
// 3 bindings, 2 push constants (gravity, dt)
layout(local_size_x = 256) in;

layout(set=0, binding=0) buffer VelY    { float data[]; } vel_y;
layout(set=0, binding=1) buffer Active  { float data[]; } alive;
layout(set=0, binding=2) buffer Grounded { float data[]; } grounded;
layout(push_constant) uniform PC {
    float gravity;
    float dt;
} pc;

void main() {
    uint i = gl_GlobalInvocationID.x;
    if (alive.data[i] != 1.0) return;
    if (grounded.data[i] == 1.0) return;  // Skip grounded entities

    vel_y.data[i] += pc.gravity * pc.dt;
}
