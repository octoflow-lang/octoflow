// GPU Batch Decode — parallel byte transforms
// 10M records decoded on GPU in one pass
// Run: octoflow run examples/batch_decode_gpu.flow

let N = 10000000
let t0 = now_ms()

// 10M bytes of encoded data on GPU
let raw = gpu_random(N, 0.0, 256.0)
let data = gpu_floor(raw)

// Parallel decode pipeline:
// Step 1 — shift byte range
let off = gpu_fill(64.0, N)
let shifted = gpu_sub(data, off)

// Step 2 — scale to printable ASCII (32-126)
let scaled = gpu_scale(shifted, 0.37)
let ascii = gpu_clamp(scaled, 32.0, 126.0)
let decoded = gpu_floor(ascii)

// Step 3 — checksum all decoded bytes
let checksum = gpu_sum(decoded)
let avg = checksum / N

let elapsed = now_ms() - t0
let smb = str(int(N / 1000000.0))
let sms = str(int(elapsed))

print("GPU Batch Decode")
print("================")
print("  {smb}M bytes decoded in {sms}ms")
print("  Avg decoded value: {avg}")
print("  Pipeline: shift → scale → clamp → floor")
