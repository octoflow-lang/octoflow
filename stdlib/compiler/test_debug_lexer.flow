// Debug: minimal lexer with one identifier in source
let src = "let"
let n = len(src)
let mut pos = 0.0
let mut tok_types = []
let mut tok_values = []
let mut tok_count = 0.0
let NL  = 10.0
let TAB = 9.0
let CR  = 13.0
let QT  = 34.0
let SP  = 32.0
let mut kw_set = map()
map_set(kw_set, "let", 1.0)

while pos < n
  let c = char_at(src, pos)
  let co = ord(c)

  if co == SP || co == TAB || co == CR
    pos = pos + 1.0
  elif co == NL
    push(tok_types, "nl")
    push(tok_values, "NL")
    tok_count = tok_count + 1.0
    pos = pos + 1.0
  elif co >= 48.0 && co <= 57.0
    let mut num = ""
    while pos < n && contains("0123456789.", char_at(src, pos))
      num = num + char_at(src, pos)
      pos = pos + 1.0
    end
    push(tok_types, "float")
    push(tok_values, num)
    tok_count = tok_count + 1.0
  elif is_match(c, "[a-zA-Z_]")
    let mut word = ""
    while pos < n && is_match(char_at(src, pos), "[a-zA-Z_0-9]")
      word = word + char_at(src, pos)
      pos = pos + 1.0
    end
    if map_has(kw_set, word)
      push(tok_types, "kw")
    else
      push(tok_types, "ident")
    end
    push(tok_values, word)
    tok_count = tok_count + 1.0
  else
    push(tok_types, "op")
    push(tok_values, c)
    tok_count = tok_count + 1.0
    pos = pos + 1.0
  end
end

push(tok_types, "eof")
push(tok_values, "EOF")
tok_count = tok_count + 1.0

print("tokens: {tok_count}")
let mut i = 0.0
while i < tok_count
  let t = tok_types[i]
  let v = tok_values[i]
  print("[{i}] {t} {v}")
  i = i + 1.0
end
