// test_rational.flow — Tests for stdlib/math/rational.flow
use "rational"

fn check(name, cond)
    if cond
        print("PASS: {name}")
    else
        print("FAIL: {name}")
        assert(0.0 == 1.0, name)
    end
    return 0.0
end

fn approx(a, b)
    if abs(a - b) < 0.001
        return 1.0
    end
    return 0.0
end

// ── Creation ────────────────────────────────────────────────

fn test_create()
    let r = rat(2.0, 4.0)
    check("simplify 2/4", rat_num(r) == 1.0 && rat_den(r) == 2.0)

    let r2 = rat(3.0, -6.0)
    check("neg denom", rat_num(r2) == -1.0 && rat_den(r2) == 2.0)

    let r3 = rat(0.0, 5.0)
    check("zero num", rat_num(r3) == 0.0)
    return 0.0
end

// ── Addition ────────────────────────────────────────────────

fn test_add()
    let a = rat(1.0, 3.0)
    let b = rat(1.0, 6.0)
    let c = rat_add(a, b)
    check("1/3 + 1/6 = 1/2", rat_num(c) == 1.0 && rat_den(c) == 2.0)

    let d = rat_add(rat(1.0, 2.0), rat(1.0, 2.0))
    check("1/2 + 1/2 = 1", rat_num(d) == 1.0 && rat_den(d) == 1.0)
    return 0.0
end

// ── Subtraction ─────────────────────────────────────────────

fn test_sub()
    let a = rat(3.0, 4.0)
    let b = rat(1.0, 4.0)
    let c = rat_sub(a, b)
    check("3/4 - 1/4 = 1/2", rat_num(c) == 1.0 && rat_den(c) == 2.0)
    return 0.0
end

// ── Multiplication ──────────────────────────────────────────

fn test_mul()
    let a = rat(2.0, 3.0)
    let b = rat(3.0, 4.0)
    let c = rat_mul(a, b)
    check("2/3 * 3/4 = 1/2", rat_num(c) == 1.0 && rat_den(c) == 2.0)
    return 0.0
end

// ── Division ────────────────────────────────────────────────

fn test_div()
    let a = rat(1.0, 2.0)
    let b = rat(1.0, 4.0)
    let c = rat_div(a, b)
    check("(1/2)/(1/4) = 2", rat_num(c) == 2.0 && rat_den(c) == 1.0)
    return 0.0
end

// ── Negation / Absolute ─────────────────────────────────────

fn test_neg_abs()
    let r = rat(3.0, 4.0)
    let n = rat_neg(r)
    check("neg 3/4", rat_num(n) == -3.0)
    let a = rat_abs(n)
    check("abs -3/4", rat_num(a) == 3.0 && rat_den(a) == 4.0)
    return 0.0
end

// ── Inverse ─────────────────────────────────────────────────

fn test_inv()
    let r = rat(3.0, 7.0)
    let i = rat_inv(r)
    check("inv 3/7", rat_num(i) == 7.0 && rat_den(i) == 3.0)
    return 0.0
end

// ── Comparison ──────────────────────────────────────────────

fn test_compare()
    let a = rat(1.0, 3.0)
    let b = rat(1.0, 2.0)
    check("1/3 < 1/2", rat_lt(a, b) == 1.0)
    check("1/2 > 1/3", rat_gt(b, a) == 1.0)
    check("eq", rat_eq(rat(2.0, 4.0), rat(1.0, 2.0)) == 1.0)
    return 0.0
end

// ── Conversion ──────────────────────────────────────────────

fn test_to_float()
    let r = rat(1.0, 4.0)
    check("to_float", rat_to_float(r) == 0.25)
    return 0.0
end

fn test_to_string()
    check("str 3/4", rat_to_string(rat(3.0, 4.0)) == "3/4")
    check("str int", rat_to_string(rat(6.0, 3.0)) == "2/1")
    return 0.0
end

// ── Predicates ──────────────────────────────────────────────

fn test_predicates()
    check("is_zero", rat_is_zero(rat(0.0, 5.0)) == 1.0)
    check("not zero", rat_is_zero(rat(1.0, 5.0)) == 0.0)
    check("is_int", rat_is_integer(rat(6.0, 3.0)) == 1.0)
    check("not int", rat_is_integer(rat(1.0, 3.0)) == 0.0)
    return 0.0
end

// ── Run all ─────────────────────────────────────────────────

test_create()
test_add()
test_sub()
test_mul()
test_div()
test_neg_abs()
test_inv()
test_compare()
test_to_float()
test_to_string()
test_predicates()
print("")
print("All rational tests passed (11 tests)")
