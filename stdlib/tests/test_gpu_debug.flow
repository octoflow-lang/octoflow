// test_gpu_debug.flow — GPU Chain Debugging Primitives Test
//
// Run: octoflow run stdlib/tests/test_gpu_debug.flow --allow-ffi --allow-read

use "../gpu/debug"
use "../gpu/runtime"

rt_init()

print("=== GPU Debug Primitives Test ===")

// ── Test 1: Assert range ───────────────────────────────────────────
let N = 16.0
let mut input = []
let mut i = 0.0
while i < N
  push(input, i + 10.0)
  i = i + 1.0
end

let buf = rt_create_buffer(N * 4.0)
rt_upload(buf, input)

let pass1 = chain_assert_range(buf, N, 10.0, 25.0, "input_range")

// ── Test 2: Assert sorted ──────────────────────────────────────────
let pass2 = chain_assert_sorted(buf, N, "input_sorted")

// ── Test 3: Assert sum ─────────────────────────────────────────────
let expected = 280.0
let pass3 = chain_assert_sum(buf, N, expected, 0.01, "input_sum")

// ── Test 4: Assert nonzero ─────────────────────────────────────────
let pass4 = chain_assert_nonzero(buf, N, "input_nonzero")

// ── Test 5: Debug inspect ──────────────────────────────────────────
chain_debug_inspect(buf, N, "input_buffer")

// ── Test 6: Debug stats ────────────────────────────────────────────
chain_debug_stats(buf, N, "input_stats")

// ── Overall ────────────────────────────────────────────────────────
print(" ")
if pass1 == 1.0
  if pass2 == 1.0
    if pass3 == 1.0
      if pass4 == 1.0
        print("PASS: All debug primitive tests passed")
      end
    end
  end
end

rt_cleanup()
